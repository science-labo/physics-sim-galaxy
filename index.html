<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>å¤ªé™½ç³»ã¨éŠ€æ²³ 3Dã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', sans-serif; overflow: hidden; background: #000; color: #fff; touch-action: none; }
        #canvas-container { width: 100vw; height: 100vh; position: relative; }
        #info-panel { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 10px; max-width: 90%; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); z-index: 10; font-size: 14px; max-height: 40vh; overflow-y: auto; }
        @media (min-width: 768px) {
            #info-panel { max-width: 380px; padding: 20px; font-size: 16px; }
        }
        h1 { font-size: 18px; margin-bottom: 10px; color: #4CAF50; }
        @media (min-width: 768px) {
            h1 { font-size: 24px; margin-bottom: 15px; }
        }
        h2 { font-size: 16px; margin: 10px 0 8px 0; color: #64B5F6; }
        @media (min-width: 768px) {
            h2 { font-size: 18px; margin: 15px 0 10px 0; }
        }
        .control-panel { position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.9); padding: 10px; border-radius: 10px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); z-index: 10; }
        @media (min-width: 768px) {
            .control-panel { left: 20px; right: auto; bottom: 20px; padding: 15px; }
        }
        button { background: #4CAF50; color: white; border: none; padding: 8px 12px; margin: 3px; border-radius: 5px; cursor: pointer; font-size: 12px; transition: all 0.3s; }
        @media (min-width: 768px) {
            button { padding: 10px 20px; margin: 5px; font-size: 14px; }
        }
        button:active { background: #45a049; transform: scale(0.95); }
        button.active { background: #2196F3; }
        .view-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 8px; }
        .planet-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 3px; }
        @media (min-width: 768px) {
            .planet-buttons { gap: 5px; }
        }
        .planet-btn { padding: 6px 8px; font-size: 11px; }
        @media (min-width: 768px) {
            .planet-btn { padding: 8px 12px; font-size: 12px; }
        }
        .scale-info { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.9); padding: 10px; border-radius: 10px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); text-align: right; z-index: 10; font-size: 11px; }
        @media (min-width: 768px) {
            .scale-info { padding: 15px; font-size: 14px; }
        }
        .legend { margin-top: 8px; font-size: 10px; color: #aaa; }
        @media (min-width: 768px) {
            .legend { margin-top: 10px; font-size: 12px; }
        }
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; color: #4CAF50; z-index: 100; }
        @media (min-width: 768px) {
            #loading { font-size: 24px; }
        }
        .warning { background: rgba(255,152,0,0.2); padding: 8px; border-radius: 5px; margin-top: 8px; font-size: 11px; color: #FFB74D; border: 1px solid rgba(255,152,0,0.4); }
        @media (min-width: 768px) {
            .warning { padding: 10px; margin-top: 10px; font-size: 12px; }
        }
        .toggle-info { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); padding: 8px 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3); z-index: 11; font-size: 12px; cursor: pointer; }
        @media (min-width: 768px) {
            .toggle-info { display: none; }
        }
        .hidden-mobile { display: none; }
        @media (min-width: 768px) {
            .hidden-mobile { display: block; }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="toggle-info" onclick="toggleInfoPanel()">â„¹ï¸ æƒ…å ±</div>
    
    <div id="info-panel" class="hidden-mobile">
        <h1>ğŸŒŒ å¤ªé™½ç³» & éŠ€æ²³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        <div id="object-info"><p>æƒ‘æ˜Ÿã¾ãŸã¯ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</p></div>
        <div class="warning">
            âš ï¸ å®Ÿéš›ã®æ¯”ç‡ãƒ¢ãƒ¼ãƒ‰ï¼šæƒ‘æ˜Ÿã¯éå¸¸ã«å°ã•ãã€å†…æƒ‘æ˜Ÿã¯å¤ªé™½ã®è¿‘ãã«å¯†é›†ã—ã¦ã„ã¾ã™ã€‚ãƒ”ãƒ³ãƒãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—ã§æ¢ç´¢ã—ã¦ãã ã•ã„ã€‚
        </div>
    </div>
    
    <div class="scale-info">
        <div>ãƒ“ãƒ¥ãƒ¼: <span id="current-view">å¤ªé™½ç³»</span></div>
        <div class="legend">
            <p>ğŸ“± ã‚¹ãƒ¯ã‚¤ãƒ—: å›è»¢</p>
            <p>ğŸ¤ ãƒ”ãƒ³ãƒ: ã‚ºãƒ¼ãƒ </p>
        </div>
    </div>
    
    <div class="control-panel">
        <div class="view-buttons">
            <button id="solar-view" class="active">å¤ªé™½ç³»</button>
            <button id="galaxy-view">éŠ€æ²³</button>
            <button id="compare-view">æ¯”è¼ƒ</button>
        </div>
        <div class="planet-buttons">
            <button class="planet-btn" data-planet="sun">å¤ªé™½</button>
            <button class="planet-btn" data-planet="mercury">æ°´æ˜Ÿ</button>
            <button class="planet-btn" data-planet="venus">é‡‘æ˜Ÿ</button>
            <button class="planet-btn" data-planet="earth">åœ°çƒ</button>
            <button class="planet-btn" data-planet="mars">ç«æ˜Ÿ</button>
            <button class="planet-btn" data-planet="jupiter">æœ¨æ˜Ÿ</button>
            <button class="planet-btn" data-planet="saturn">åœŸæ˜Ÿ</button>
            <button class="planet-btn" data-planet="uranus">å¤©ç‹æ˜Ÿ</button>
            <button class="planet-btn" data-planet="neptune">æµ·ç‹æ˜Ÿ</button>
            <button class="planet-btn" data-planet="halley">å½—æ˜Ÿ</button>
        </div>
    </div>
    
    <div id="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene,camera,renderer,planets={},galaxyGroup,solarSystemGroup,blackHole;
        let touchStartDistance=0;
        let lastTouchX=0,lastTouchY=0;
        
        function toggleInfoPanel(){
            const panel=document.getElementById('info-panel');
            panel.classList.toggle('hidden-mobile');
        }
        
        const planetData={
            sun:{name:'å¤ªé™½',radius:696000,distance:0,color:0xFDB813,info:'å¤ªé™½ç³»ã®ä¸­å¿ƒã«ã‚ã‚‹æ’æ˜Ÿã€‚è³ªé‡ã¯å¤ªé™½ç³»å…¨ä½“ã®99.86%ã‚’å ã‚ã‚‹ã€‚',realSize:'ç›´å¾„: 1,392,000 km',rotation:0.004},
            mercury:{name:'æ°´æ˜Ÿ',radius:2440,distance:57910000,color:0x8C7853,info:'å¤ªé™½ã«æœ€ã‚‚è¿‘ã„æƒ‘æ˜Ÿã€‚è¡¨é¢æ¸©åº¦ã¯æ˜¼é–“430Â°Cã€å¤œé–“-180Â°Cã€‚',realSize:'ç›´å¾„: 4,880 km',rotation:0.01},
            venus:{name:'é‡‘æ˜Ÿ',radius:6052,distance:108200000,color:0xFFC649,info:'åœ°çƒã®åŒå­æ˜Ÿã¨å‘¼ã°ã‚Œã‚‹ã€‚æ¿ƒã„äºŒé…¸åŒ–ç‚­ç´ ã®å¤§æ°—ã«ã‚ˆã‚Šæ¸©å®¤åŠ¹æœã§é«˜æ¸©ã€‚',realSize:'ç›´å¾„: 12,104 km',rotation:0.008},
            earth:{name:'åœ°çƒ',radius:6371,distance:149600000,color:0x4169E1,info:'ç§ãŸã¡ã®æ•…éƒ·ã€‚æ¶²ä½“ã®æ°´ã¨ç”Ÿå‘½ãŒå­˜åœ¨ã™ã‚‹å”¯ä¸€ã®æƒ‘æ˜Ÿã€‚',realSize:'ç›´å¾„: 12,742 km',rotation:0.02},
            mars:{name:'ç«æ˜Ÿ',radius:3390,distance:227900000,color:0xCD5C5C,info:'èµ¤ã„æƒ‘æ˜Ÿã€‚é…¸åŒ–é‰„ã«ã‚ˆã‚Šèµ¤ãè¦‹ãˆã‚‹ã€‚å°†æ¥ã®äººé¡ç§»ä½å€™è£œåœ°ã€‚',realSize:'ç›´å¾„: 6,779 km',rotation:0.018},
            jupiter:{name:'æœ¨æ˜Ÿ',radius:69911,distance:778500000,color:0xDAA520,info:'å¤ªé™½ç³»æœ€å¤§ã®æƒ‘æ˜Ÿã€‚å¤§èµ¤æ–‘ã¨ã„ã†å·¨å¤§ãªåµãŒã‚ã‚‹ã€‚',realSize:'ç›´å¾„: 139,820 km',rotation:0.04},
            saturn:{name:'åœŸæ˜Ÿ',radius:58232,distance:1432000000,color:0xF4E6C3,info:'ç¾ã—ã„ç’°ã‚’æŒã¤æƒ‘æ˜Ÿã€‚ç’°ã¯æ°·ã‚„å²©çŸ³ã®ç²’å­ã§ã§ãã¦ã„ã‚‹ã€‚',realSize:'ç›´å¾„: 116,460 km',rotation:0.038},
            uranus:{name:'å¤©ç‹æ˜Ÿ',radius:25362,distance:2867000000,color:0x4FD0E7,info:'æ¨ªå€’ã—ã§è‡ªè»¢ã™ã‚‹æƒ‘æ˜Ÿã€‚ãƒ¡ã‚¿ãƒ³ã®å¤§æ°—ã«ã‚ˆã‚Šé’ç·‘è‰²ã€‚',realSize:'ç›´å¾„: 50,724 km',rotation:0.03},
            neptune:{name:'æµ·ç‹æ˜Ÿ',radius:24622,distance:4515000000,color:0x4166F5,info:'å¤ªé™½ç³»ã§æœ€ã‚‚é ã„æƒ‘æ˜Ÿã€‚å¼·ã„é¢¨ãŒå¹ãè’ã‚Œã‚‹ã€‚',realSize:'ç›´å¾„: 49,244 km',rotation:0.032},
            halley:{name:'ãƒãƒ¬ãƒ¼å½—æ˜Ÿ',radius:5500,distance:5250000000,color:0xCCCCCC,info:'ç´„76å¹´å‘¨æœŸã§å¤ªé™½ã«æ¥è¿‘ã™ã‚‹æœ‰åãªå½—æ˜Ÿã€‚æ¬¡å›ã®æ¥è¿‘ã¯2061å¹´ã€‚',realSize:'æ ¸ã®ç›´å¾„: ç´„15Ã—8 km',rotation:0.05,isComet:true,eccentricity:0.967}
        };
        
        const SCALE_FACTOR=1/1000000;
        const SIZE_SCALE=1/20000;
        
        function init(){
            scene=new THREE.Scene();
            scene.background=new THREE.Color(0x000000);
            camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000000);
            camera.position.set(0,200,400);
            renderer=new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(window.innerWidth,window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            scene.add(new THREE.AmbientLight(0x333333,1.5));
            const sunLight=new THREE.PointLight(0xFFFFAA,4,0);
            scene.add(sunLight);
            
            createStarfield();
            createSolarSystem();
            setupControls();
            setupEventListeners();
            document.getElementById('loading').style.display='none';
            animate();
        }
        
        function createStarfield(){
            const geometry=new THREE.BufferGeometry(),vertices=[];
            for(let i=0;i<20000;i++)vertices.push((Math.random()-0.5)*50000,(Math.random()-0.5)*50000,(Math.random()-0.5)*50000);
            geometry.setAttribute('position',new THREE.Float32BufferAttribute(vertices,3));
            scene.add(new THREE.Points(geometry,new THREE.PointsMaterial({color:0xFFFFFF,size:2})));
        }
        
        function createSolarSystem(){
            solarSystemGroup=new THREE.Group();
            Object.keys(planetData).forEach(key=>{
                const data=planetData[key];
                const displayRadius=data.radius*SIZE_SCALE;
                const displayDistance=data.distance*SCALE_FACTOR;
                const geometry=new THREE.SphereGeometry(displayRadius,32,32);
                const material=new THREE.MeshPhongMaterial({color:data.color,emissive:key==='sun'?data.color:0x000000,emissiveIntensity:key==='sun'?0.9:0,shininess:key==='sun'?100:30});
                const planet=new THREE.Mesh(geometry,material);
                planet.position.x=displayDistance;
                if(key!=='sun'){
                    const orbitPoints=[];
                    for(let i=0;i<=256;i++){
                        const angle=(i/256)*Math.PI*2;
                        const ecc=data.eccentricity||0;
                        const a=displayDistance;
                        const r=a*(1-ecc*ecc)/(1+ecc*Math.cos(angle));
                        orbitPoints.push(new THREE.Vector3(Math.cos(angle)*r,0,Math.sin(angle)*r));
                    }
                    const orbitGeometry=new THREE.BufferGeometry().setFromPoints(orbitPoints);
                    const orbitMaterial=new THREE.LineBasicMaterial({color:data.isComet?0x666666:0x555555,transparent:true,opacity:data.isComet?0.3:0.6});
                    solarSystemGroup.add(new THREE.Line(orbitGeometry,orbitMaterial));
                }
                if(key==='saturn'){
                    const ring=new THREE.Mesh(new THREE.RingGeometry(displayRadius*1.5,displayRadius*2.5,64),new THREE.MeshBasicMaterial({color:0xF4E6C3,side:THREE.DoubleSide,transparent:true,opacity:0.7}));
                    ring.rotation.x=Math.PI/2;
                    planet.add(ring);
                }
                if(data.isComet){
                    const tailLength=displayRadius*10;
                    const tail=new THREE.Mesh(new THREE.ConeGeometry(displayRadius*0.6,tailLength,8),new THREE.MeshBasicMaterial({color:0x88CCFF,transparent:true,opacity:0.5}));
                    tail.rotation.z=Math.PI/2;
                    tail.position.x=-tailLength/2;
                    planet.add(tail);
                }
                solarSystemGroup.add(planet);
                planets[key]={mesh:planet,data:data,angle:Math.random()*Math.PI*2,distance:displayDistance,radius:displayRadius,eccentricity:data.eccentricity||0};
            });
            scene.add(solarSystemGroup);
        }
        
        function createGalaxy(){
            if(galaxyGroup)scene.remove(galaxyGroup);
            galaxyGroup=new THREE.Group();
            // éŠ€æ²³ã®æ ¼å­çŠ¶ãƒˆãƒ¼ãƒ©ã‚¹ã‚’å‰Šé™¤ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
            const bulge=new THREE.Mesh(new THREE.SphereGeometry(150,32,32),new THREE.MeshBasicMaterial({color:0xFFAA33,transparent:true,opacity:0.6}));
            galaxyGroup.add(bulge);
            blackHole=new THREE.Mesh(new THREE.SphereGeometry(20,32,32),new THREE.MeshBasicMaterial({color:0x000000,emissive:0x000000}));
            galaxyGroup.add(blackHole);
            const accretionDisk=new THREE.Mesh(new THREE.RingGeometry(25,60,64),new THREE.MeshBasicMaterial({color:0xFF6600,side:THREE.DoubleSide,transparent:true,opacity:0.8}));
            accretionDisk.rotation.x=Math.PI/2;
            blackHole.add(accretionDisk);
            const jet1=new THREE.Mesh(new THREE.CylinderGeometry(5,8,300,8),new THREE.MeshBasicMaterial({color:0x00AAFF,transparent:true,opacity:0.6}));
            jet1.position.y=150;
            blackHole.add(jet1);
            const jet2=new THREE.Mesh(new THREE.CylinderGeometry(5,8,300,8),new THREE.MeshBasicMaterial({color:0x00AAFF,transparent:true,opacity:0.6}));
            jet2.position.y=-150;
            blackHole.add(jet2);
            const starsVertices=[],starsColors=[];
            for(let i=0;i<150000;i++){
                const angle=Math.random()*Math.PI*2,spiralAngle=angle*3;
                let radius=Math.random()*800;
                if(Math.random()<0.3)radius=Math.random()*200;
                const x=Math.cos(angle+spiralAngle*0.2)*radius,z=Math.sin(angle+spiralAngle*0.2)*radius,y=(Math.random()-0.5)*Math.max(10,80*(1-radius/800));
                starsVertices.push(x,y,z);
                const colorFactor=radius/800;
                starsColors.push(1,0.8+colorFactor*0.2,0.6+colorFactor*0.4);
            }
            const starsGeometry=new THREE.BufferGeometry();
            starsGeometry.setAttribute('position',new THREE.Float32BufferAttribute(starsVertices,3));
            starsGeometry.setAttribute('color',new THREE.Float32BufferAttribute(starsColors,3));
            galaxyGroup.add(new THREE.Points(starsGeometry,new THREE.PointsMaterial({size:1,vertexColors:true,transparent:true,opacity:0.8})));
            const marker=new THREE.Mesh(new THREE.SphereGeometry(5,16,16),new THREE.MeshBasicMaterial({color:0xFFFF00}));
            marker.position.set(560,5,0);
            galaxyGroup.add(marker);
            scene.add(galaxyGroup);
        }
        
        function setupControls(){
            let isDragging=false,prev={x:0,y:0};
            
            // ãƒã‚¦ã‚¹æ“ä½œï¼ˆPCç”¨ï¼‰
            renderer.domElement.addEventListener('mousedown',e=>{isDragging=true;prev={x:e.clientX,y:e.clientY}});
            renderer.domElement.addEventListener('mousemove',e=>{
                if(isDragging){
                    camera.position.x+=(e.clientX-prev.x)*0.5;
                    camera.position.y-=(e.clientY-prev.y)*0.5;
                    camera.lookAt(0,0,0);
                    prev={x:e.clientX,y:e.clientY};
                }
            });
            renderer.domElement.addEventListener('mouseup',()=>isDragging=false);
            renderer.domElement.addEventListener('wheel',e=>{
                e.preventDefault();
                const zoomSpeed=camera.position.length()*0.001;
                camera.position.z=Math.max(5,Math.min(camera.position.z+e.deltaY*zoomSpeed,10000));
            });
            
            // ã‚¿ãƒƒãƒæ“ä½œï¼ˆã‚¹ãƒãƒ›/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ï¼‰
            renderer.domElement.addEventListener('touchstart',e=>{
                e.preventDefault();
                if(e.touches.length===1){
                    isDragging=true;
                    lastTouchX=e.touches[0].clientX;
                    lastTouchY=e.touches[0].clientY;
                }else if(e.touches.length===2){
                    isDragging=false;
                    const dx=e.touches[0].clientX-e.touches[1].clientX;
                    const dy=e.touches[0].clientY-e.touches[1].clientY;
                    touchStartDistance=Math.sqrt(dx*dx+dy*dy);
                }
            },{passive:false});
            
            renderer.domElement.addEventListener('touchmove',e=>{
                e.preventDefault();
                if(e.touches.length===1&&isDragging){
                    const deltaX=(e.touches[0].clientX-lastTouchX)*0.8;
                    const deltaY=(e.touches[0].clientY-lastTouchY)*0.8;
                    camera.position.x+=deltaX;
                    camera.position.y-=deltaY;
                    camera.lookAt(0,0,0);
                    lastTouchX=e.touches[0].clientX;
                    lastTouchY=e.touches[0].clientY;
                }else if(e.touches.length===2){
                    const dx=e.touches[0].clientX-e.touches[1].clientX;
                    const dy=e.touches[0].clientY-e.touches[1].clientY;
                    const distance=Math.sqrt(dx*dx+dy*dy);
                    const delta=(touchStartDistance-distance)*2;
                    camera.position.z=Math.max(5,Math.min(camera.position.z+delta,10000));
                    touchStartDistance=distance;
                }
            },{passive:false});
            
            renderer.domElement.addEventListener('touchend',e=>{
                e.preventDefault();
                isDragging=false;
                touchStartDistance=0;
            },{passive:false});
        }
        
        function setupEventListeners(){
            document.getElementById('solar-view').addEventListener('click',()=>switchView('solar'));
            document.getElementById('galaxy-view').addEventListener('click',()=>switchView('galaxy'));
            document.getElementById('compare-view').addEventListener('click',()=>switchView('compare'));
            document.querySelectorAll('.planet-btn').forEach(btn=>btn.addEventListener('click',()=>focusOnPlanet(btn.dataset.planet)));
            window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)});
        }
        
        function switchView(view){
            document.querySelectorAll('.control-panel button').forEach(btn=>btn.classList.remove('active'));
            if(view==='solar'){
                document.getElementById('solar-view').classList.add('active');
                camera.position.set(0,200,400);
                camera.lookAt(0,0,0);
                if(galaxyGroup)scene.remove(galaxyGroup);
                if(solarSystemGroup){solarSystemGroup.visible=true;solarSystemGroup.position.set(0,0,0);solarSystemGroup.scale.set(1,1,1);}
                document.getElementById('current-view').textContent='å¤ªé™½ç³»';
                updateInfo('','å¤ªé™½ç³»å…¨ä½“ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚æƒ‘æ˜Ÿã‚’ã‚¿ãƒƒãƒ—ã—ã¦è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚');
            }else if(view==='galaxy'){
                document.getElementById('galaxy-view').classList.add('active');
                if(solarSystemGroup)solarSystemGroup.visible=false;
                createGalaxy();
                camera.position.set(0,600,1200);
                camera.lookAt(0,0,0);
                document.getElementById('current-view').textContent='å¤©ã®å·éŠ€æ²³';
                updateInfo('å¤©ã®å·éŠ€æ²³','ä¸­å¿ƒã«ã¯è¶…å¤§è³ªé‡ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ã€Œã„ã¦åº§A*ã€ãŒå­˜åœ¨ã—ã¾ã™ã€‚ä¸­å¤®ã®é»„è‰²ã„è†¨ã‚‰ã¿ãŒãƒãƒ«ã‚¸ã€å‘¨å›²ãŒéŠ€æ²³å††ç›¤ã§ã™ã€‚');
            }else{
                document.getElementById('compare-view').classList.add('active');
                createGalaxy();
                if(solarSystemGroup){solarSystemGroup.visible=true;solarSystemGroup.position.set(560,5,0);solarSystemGroup.scale.set(0.01,0.01,0.01);}
                camera.position.set(0,500,1000);
                camera.lookAt(0,0,0);
                document.getElementById('current-view').textContent='æ¯”è¼ƒ';
                updateInfo('ã‚¹ã‚±ãƒ¼ãƒ«æ¯”è¼ƒ','éŠ€æ²³ã¯å¤ªé™½ç³»ã®ç´„10ä¸‡å€ã®å¤§ãã•ã§ã™ï¼éŠ€æ²³ã®ä¸­ã®é»„è‰²ã„ç‚¹ã®ä½ç½®ã«ã€æ¥µå°ã®å¤ªé™½ç³»ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚');
            }
        }
        
        function focusOnPlanet(planetKey){
            const planet=planets[planetKey];
            if(!planet)return;
            if(solarSystemGroup){solarSystemGroup.position.set(0,0,0);solarSystemGroup.scale.set(1,1,1);solarSystemGroup.visible=true;}
            if(galaxyGroup)scene.remove(galaxyGroup);
            document.getElementById('solar-view').classList.add('active');
            document.getElementById('galaxy-view').classList.remove('active');
            document.getElementById('compare-view').classList.remove('active');
            const pos=planet.mesh.position;
            const zoomDistance=planet.radius*50;
            camera.position.set(pos.x+zoomDistance,pos.y+zoomDistance*0.5,pos.z+zoomDistance);
            camera.lookAt(pos.x,pos.y,pos.z);
            const distanceInfo=planetKey==='sun'?'':'<br><br>å¤ªé™½ã‹ã‚‰ã®è·é›¢: '+(planet.data.distance/1000000).toFixed(1)+'ç™¾ä¸‡km';
            updateInfo(planet.data.name,planet.data.info+'<br><br>'+planet.data.realSize+distanceInfo);
        }
        
        function updateInfo(title,content){
            document.getElementById('object-info').innerHTML=title?'<h2>'+title+'</h2><p>'+content+'</p>':'<p>'+content+'</p>';
        }
        
        function animate(){
            requestAnimationFrame(animate);
            Object.keys(planets).forEach(key=>{
                const planet=planets[key];
                planet.mesh.rotation.y+=planet.data.rotation;
                if(key!=='sun'){
                    planet.angle-=0.001/Math.sqrt(planet.distance||1);
                    const ecc=planet.eccentricity,a=planet.distance;
                    const r=a*(1-ecc*ecc)/(1+ecc*Math.cos(planet.angle));
                    planet.mesh.position.x=Math.cos(planet.angle)*r;
                    planet.mesh.position.z=Math.sin(planet.angle)*r;
                    if(planet.data.isComet){
                        const angle=Math.atan2(planet.mesh.position.z,planet.mesh.position.x);
                        planet.mesh.rotation.y=-angle;
                    }
                }
            });
            if(galaxyGroup){galaxyGroup.rotation.y+=0.0005;if(blackHole)blackHole.rotation.y+=0.02;}
            renderer.render(scene,camera);
        }
        
        init();
    </script>
</body>
</html>
